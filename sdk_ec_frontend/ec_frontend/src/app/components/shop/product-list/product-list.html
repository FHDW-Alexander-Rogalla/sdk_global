<div class="products-container">
  <h1>Products</h1>

  <!-- Not Authenticated State -->
  <div *ngIf="!isAuthenticated" class="auth-required">
    <div class="auth-message">
      <h2>Account Required</h2>
      <p>You need an account to view products and shop. Please log in if you already have an account, or create a new one to get started.</p>
      <div class="auth-buttons">
        <button class="login-btn" (click)="navigateToLogin()">Log In</button>
        <button class="register-btn" (click)="navigateToRegister()">Create Account</button>
      </div>
    </div>
  </div>

  <!-- Authenticated - Show Products -->
  <ng-container *ngIf="isAuthenticated">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
      <p>Loading products...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error">
      <p>{{ error }}</p>
      <button (click)="loadProducts()">Try again</button>
    </div>

    <!-- Products List -->
    <div *ngIf="!loading && !error" class="products-grid">
      <div *ngFor="let product of products" class="product-card">
        <!-- Product Image -->
        <div class="product-image">
          <img 
            [src]="product.imageUrl || 'https://via.placeholder.com/300x200?text=No+Image'" 
            [alt]="product.name"
          />
        </div>

        <!-- Product Info -->
        <div class="product-info">
          <h3>{{ product.name }}</h3>
          <p class="description">{{ product.description || 'No description available' }}</p>
          <p class="price">{{ product.price | currency:'EUR' }}</p>
        </div>

        <!-- Quantity, inline status & Add to Cart -->
        <div class="product-actions">
          <div class="action-row">
            <div class="quantity-selector">
              <label for="quantity-{{ product.id }}">Quantity:</label>
              <input 
                type="number" 
                id="quantity-{{ product.id }}"
                [(ngModel)]="product.quantity" 
                min="1" 
                max="99"
                [disabled]="isAddingToCart(product.id)"
              />
            </div>
            <div class="inline-status" *ngIf="getStatus(product.id) as status">
              <span class="status-chip" 
                    [class.success]="status.type === 'success'" 
                    [class.error]="status.type === 'error'">
                {{ status.text }}
              </span>
            </div>
          </div>
          <button 
            class="add-to-cart-btn" 
            (click)="addToCart(product)"
            [disabled]="isAddingToCart(product.id)"
          >
            <span *ngIf="!isAddingToCart(product.id)">Add to Cart</span>
            <span *ngIf="isAddingToCart(product.id)">Adding...</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && products.length === 0" class="empty-state">
      <p>No products available</p>
    </div>
  </ng-container>
</div>
